<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario Inscripción</title>
    <link rel="stylesheet" href="../css/styleFormulario.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        // Inicializa EmailJS con tu USER_ID
        (function () {
            emailjs.init("q7MqNuJMx_TcESL1i");
        })();

        window.onload = function () {
            document.getElementById("team-form").addEventListener("submit", function (event) {
                event.preventDefault(); // Evita que el formulario recargue la página

                // Recoge los datos del formulario
                const teamName = document.getElementById("team_name").value;
                const category = document.getElementById("category").value;
                const phone = document.getElementById("phone").value;
                const email = document.getElementById("email").value;

                const players = [];
                players.push({
                    name: document.getElementById(`player_name_1`).value,
                    surname: document.getElementById(`player_surname_1`).value,
                    insurance_number: document.getElementById(`insurance_number_1`).value,
                    dni: document.getElementById(`dni_1`).value,
                    main_team: document.getElementById(`main_team_1`).value,
                    goalkeeper: document.getElementById(`goalkeeper_2`).checked,
                });

                for (let i = 2; i <= 4; i++) {
                    players.push({
                        name: document.getElementById(`player_name_${i}`).value,
                        surname: document.getElementById(`player_surname_${i}`).value,
                        insurance_number: document.getElementById(`insurance_number_${i}`).value,
                        dni: document.getElementById(`dni_${i}`).value,
                        main_team: document.getElementById(`main_team_${i}`)?.value || "",
                    });
                }

                // Crea un mensaje para enviar a EmailJS
                const message = `
                    Nombre del Equipo: ${teamName}
                    Categoría: ${category}
                    Número de Teléfono: ${phone}
                    Correo Electrónico: ${email}
                    Jugadores: ${players
                        .map((player, index) => `
                        Jugador ${index + 1}:
                        Nombre: ${player.name}, 
                        Apellidos: ${player.surname}, 
                        Número de Seguro: ${player.insurance_number}, 
                        DNI: ${player.dni}, 
                        Equipo Principal: ${player.main_team}, 
                        ¿Es Portero?: ${player.goalkeeper ? "Sí" : "No"}
                    `)
                    .join("")}
                `;

                // Envía los datos a EmailJS
                emailjs.send("service_8s73heh", "template_SaraRoces", {
                    from_name: teamName,
                    to_email: email,
                    message: message,
                })
                .then(function (response) {
                    console.log("Correo enviado con éxito!", response.status, response.text);
                    // Redirige a la página final después de enviar el correo
                    window.location.href = "finalFormulario.html";
                }, function (error) {
                    console.log("Error al enviar el correo.", error);
                    alert("Hubo un error al enviar el correo.");
                });

                // El formulario se envía a Netlify automáticamente debido a la acción y método
            });
        };
    </script>
</head>

<body>
    <div class="container mt-5">
        <h2>Formulario de Inscripción del Equipo</h2>
        <form id="team-form" action="https://your-netlify-site.netlify.app/" method="POST" netlify>
            <input type="hidden" name="form-name" value="team-form" />
            <div class="form-group">
                <label for="team_name">Nombre del Equipo:</label>
                <input type="text" class="form-control" id="team_name" name="team_name" required />
            </div>
            <div class="form-group">
                <label for="category">Categoría:</label>
                <select class="form-control" id="category" name="category" required>
                    <option value="" disabled selected>Seleccione una categoría</option>
                    <option value="Mini">Mini</option>
                    <option value="Guajes">Guajes</option>
                    <option value="Promesas">Promesas</option>
                    <option value="Estrellas">Estrellas</option>
                    <option value="OK Masters">OK Masters</option>
                </select>
            </div>
            <div class="form-group">
                <label for="phone">Número de Teléfono de la persona de contacto:</label>
                <input type="tel" class="form-control" id="phone" name="phone" required />
            </div>
            <div class="form-group">
                <label for="email">Correo Electrónico de la persona de contacto:</label>
                <input type="email" class="form-control" id="email" name="email" required />
            </div>

            <h4>Datos de los Jugadores</h4>
            <fieldset class="border p-3 mb-3">
                <legend class="w-auto">Portero</legend>
                <div class="form-group">
                    <label for="player_name_1">Nombre:</label>
                    <input type="text" class="form-control" id="player_name_1" name="player_name_1" required />
                </div>
                <div class="form-group">
                    <label for="player_surname_1">Apellidos:</label>
                    <input type="text" class="form-control" id="player_surname_1" name="player_surname_1" required />
                </div>
                <div class="form-group">
                    <label for="insurance_number_1">Número de Licencia:</label>
                    <input type="text" class="form-control" id="insurance_number_1" name="insurance_number_1" required />
                </div>
                <div class="form-group">
                    <label for="goalkeeper_2">¿Juegas en dos equipos?</label>
                    <input type="checkbox" id="goalkeeper_2" name="goalkeeper_2" />
                </div>
                <div class="form-group" id="main_team_container" style="display: none;">
                    <label for="main_team_1">Equipo Principal:</label>
                    <input type="text" class="form-control" id="main_team_1" name="main_team_1" />
                </div>
            </fieldset>

            <!-- Repite campos para Jugador 1, Jugador 2 y Jugador 3 aquí... -->

            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="accept_terms" required />
                <label class="form-check-label" for="accept_terms">He leído y acepto los términos y condiciones.</label>
            </div>
            <button type="submit" class="btn btn-primary">Enviar Formulario</button>
            <button type="button" class="btn btn-secondary" onclick="window.history.back();">Volver Atrás</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const checkbox = document.getElementById("goalkeeper_2");
            const mainTeamContainer = document.getElementById("main_team_container");
            checkbox.addEventListener("change", function () {
                if (checkbox.checked) {
                    mainTeamContainer.style.display = "block";
                    document.getElementById("main_team_1").setAttribute("required", "required");
                } else {
                    mainTeamContainer.style.display = "none";
                    document.getElementById("main_team_1").removeAttribute("required");
                }
            });
        });
    </script>
</body>
</html>
